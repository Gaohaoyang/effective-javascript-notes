# 第6条 了解分号插入的局限

* 仅在 `}` 标记之前、一行的结束和程序的结尾处插入分号。
* 仅在紧接着的标记不能被解析的时候插入分号。
* 在以`(`,`[`,`+`,`-`,`/`字符开头的语句前决不能省略分号。
* 当脚本链接的时候，在脚本之间显示的插入分号。
* 在 `return`,`throw`,`break`,`continue`,`++`,`--` 的参数之前绝不能换行。
* 分号不能作为 `for` 循环的头部或空语句的分隔符而被插入出。

---

JavaScript 的自动分号插入（automatic semicolon insertion）技术，能推断出某些上下文中省略的分号，然后有效地自动的将分号“插入”到程序中。例如下面的代码是能正常工作的。

```js
function Point(x,y) {
    this.x = x || 0
    this.y = y || 0
}
```

* **仅在 `}` 标记之前、一行的结束和程序的结尾处插入分号。**

意思是只能在一行、一个代码块或一段程序结束的地方省略分号。

* **仅在紧接着的标记不能被解析的时候插入分号。**

例如：

```js
var x
a = b
(f())
```

会被解析为：

```js
var x
a = b(f())
```

这也引出了：

* **在以`(`,`[`,`+`,`-`,`/`字符开头的语句前决不能省略分号。**

所以上述代码应该改为：

```js
var x
a = b
;(f())
```

* **当脚本链接的时候，在脚本之间显示的插入分号。**

主要避免如下情况

```js
//a.js
(function () {

})()
//b.js
(function () {

})()
```

当每个文件作为单独的程序加载时，会被解析为：

```js
(function () {

})()(function () {

})()
```

正确做法是：

```js
//a.js
;(function () {

})()
//b.js
;(function () {

})()
```

* **在 `return`,`throw`,`break`,`continue`,`++`,`--` 的参数之前绝不能换行。**

```js
return {};//返回一个新对象
```

但下面的代码

```js
return
{};
```

会被解析为3条独立语句：

```js
return;
{}
;
```

即，return 关键字后的换行会强制自动插入分号。

* **分号不能作为 `for` 循环的头部或空语句的分隔符而被插入出。**

下面的代码解析错误。

```js
for (var i = 0
    i < array.length
    i++) {
    array[i]
}
```
